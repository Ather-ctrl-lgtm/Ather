-- Old RollCall table
CREATE TABLE O_RollCall (Roll_no NUMBER PRIMARY KEY, Name VARCHAR2(50));

-- New RollCall table
CREATE TABLE N_RollCall ( Roll_no NUMBER, Name VARCHAR2(50));

-- Sample Data for Old RollCall
INSERT INTO O_RollCall VALUES (1, 'Amit Sharma');
INSERT INTO O_RollCall VALUES (2, 'Priya Mehta');

-- Sample Data for New RollCall
INSERT INTO N_RollCall VALUES (2, 'Priya Mehta'); -- Duplicate
INSERT INTO N_RollCall VALUES (3, 'Rahul Singh'); -- New
INSERT INTO N_RollCall VALUES (4, 'Sneha Patil'); -- New

COMMIT;

-- Text editor block
DECLARE
    CURSOR cur_new(p_rollno NUMBER) IS
        SELECT Roll_no, Name
        FROM N_RollCall
        WHERE Roll_no = p_rollno;

    v_rollno N_RollCall.Roll_no%TYPE;
    v_name   N_RollCall.Name%TYPE;
    v_count  NUMBER;
BEGIN
    -- Loop through all rows in N_RollCall
    FOR rec IN (SELECT * FROM N_RollCall) LOOP
        -- Open cursor for current Roll_no
        OPEN cur_new(rec.Roll_no);
        FETCH cur_new INTO v_rollno, v_name;
        CLOSE cur_new;

        -- Check if Roll_no exists in O_RollCall
        SELECT COUNT(*) INTO v_count
        FROM O_RollCall
        WHERE Roll_no = v_rollno;

        IF v_count = 0 THEN
            INSERT INTO O_RollCall (Roll_no, Name)
            VALUES (v_rollno, v_name);
            DBMS_OUTPUT.PUT_LINE('Inserted: ' || v_rollno || ' - ' || v_name);
        ELSE
            DBMS_OUTPUT.PUT_LINE('Skipped (already exists): ' || v_rollno);
        END IF;
    END LOOP;

    COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error: ' || SQLERRM);
END;
/
